version: "3"

vars:
  G_LINT_PY_DIR: "{{.ROOT_DIR}}/exports/lint-configs/python"

tasks:
  check-py:
    cmds:
      - task: "py"
        vars:
          RUFF_FORMAT_FLAGS: "--diff"

  fix-py:
    cmds:
      - task: "py"
        vars:
          RUFF_CHECK_FLAGS: "--fix"

  py:
    internal: true
    deps: ["venv"]
    vars:
      SRC_FILES_:
        sh: |-
          "{{.ROOT_DIR}}/exports/scripts/find.py"\
            "{{.ROOT_DIR}}" \
            --exclude "build/**/*" \
            --file-name "*.py" \
            --file-name "*.pyi"
      SRC_FILES:
        ref: >-
          splitList "\n" .SRC_FILES_
    cmds:
      - for:
          var: "SRC_FILES"
        cmd: |-
          . "{{.G_LINT_VENV_DIR}}/bin/activate"
          mypy --config-file "{{.G_LINT_PY_DIR}}/mypy.ini" {{.MYPY_FLAGS}} "{{.ITEM}}"
          ruff --config "{{.G_LINT_PY_DIR}}/ruff.toml" check {{.RUFF_CHECK_FLAGS}} "{{.ITEM}}"
          ruff --config "{{.G_LINT_PY_DIR}}/ruff.toml" format {{.RUFF_FORMAT_FLAGS}} "{{.ITEM}}"
